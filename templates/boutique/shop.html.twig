    {% extends 'base.html.twig' %}

    {% block body %}
        {{ parent() }}
        <div class="container mt-5">
            <form id="search-form" class="mb-3">
                <label for="search">Search:</label>
                <input type="text" id="search" name="criteria[nom]" class="form-control">
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
            <div class="row" id="product-list">
            {% dump(produit) %}
                {% for product in produit %}
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img src="{{ asset('pictures/' ~ product.image) }}" alt="{{ product.nom }}" class="card-img-top" style="max-height: 200px; width: 100%; object-fit: cover;">
                            <div class="card-body text-center d-flex flex-column align-items-center">
                                <h5 class="card-title">{{ product.nom }}</h5>
                                <p class="card-text">Prix : {{ product.prix }} €</p>
                                
                                <form action="{{ path('add_to_cart', {'id': product.idpdts}) }}" method="post" class="mt-auto">
                                    <label for="quantity">Quantity:</label>
                                    <input type="number" id="quantity" name="quantity" class="form-control mb-2" value="1" min="1">
                                    <button type="submit" class="btn btn-primary">Add to Basket</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    {% if loop.index % 3 == 0 %}
                        </div><div class="row">
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var searchForm = document.getElementById('search-form');
                var productList = document.getElementById('product-list');
                var baseUrl = '{{ path('add_to_cart', {'id': '_id_'})|replace({'_id_': ''}) }}';

                searchForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    var formData = new FormData(searchForm);
                    
                    // Construct the URL with parameters
                    var url = '{{ path('search_products') }}?nom=' + encodeURIComponent(formData.get('criteria[nom]'));

                    // Use the Fetch API to make a GET request
                    fetch(url)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                             console.log('Response data:', data);
                            productList.innerHTML = '';

                            data.produit.forEach(function (product) {
                                var productCard = `
                                    <div class="col-md-4 mb-4">
                                        <div class="card">
                                            <img src="{{ asset('pictures/') }}${product.image}" alt="${product.nom}" class="card-img-top" style="max-height: 200px; width: 100%; object-fit: cover;">
                                            <div class="card-body text-center d-flex flex-column align-items-center">
                                                <h5 class="card-title">${product.nom || 'Unknown Product'}</h5>
                                                <p class="card-text">Prix : ${product.prix || 'N/A'} €</p>
                                                
                                                <form action="${baseUrl}${product.idpdts}" method="post" class="mt-auto">
                                                    <label for="quantity">Quantity:</label>
                                                    <input type="number" id="quantity" name="quantity" class="form-control mb-2" value="1" min="1">
                                                    <button type="submit" class="btn btn-primary">Add to Basket</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                `;

                                productList.innerHTML += productCard;
                            });
                        })
                        .catch(error => {
                            // Handle the error, e.g., log it or display an error message
                            console.error('Error:', error.message);
                        });
                });
            });
        
        </script>
    {% endblock %}
