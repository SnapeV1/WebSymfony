{% extends 'base.html.twig' %}

{% block body %}
    {{ parent() }}
    <div class="container mt-5">
        <div class="row">
            {% for training in training %}
                <div class="col-md-4 mb-4">
                    <div class="card">
                        {% if loop.index is divisible by(4) %}
                            </div><div class="row">
                        {% endif %}

                             {% if training.video is not null %}
                            <video controls width="150" height="100">
                               {% if training.video starts with 'file:/' %}
        {# Extract filename from the video path #}
        {% set filename = training.video|split('/')|last %}
        <source src="{{ asset('uploads/' ~ filename) }}" type="video/mp4">
    {% else %}
        <source src="{{ asset('uploads/' ~ training.video) }}" type="video/mp4">
    {% endif %}
    Your browser does not support the video tag.
                            </video>
                        {% else %}
                            No Video
                        {% endif %}
                        </video>

                        <div class="card-body text-center d-flex flex-column align-items-center">
                            <h5 class="card-title">{{ training.titre }}</h5>
                            <p class="card-text">Prix : {{ training.prix }} dt</p>

                                            <!-- Regrouper le bouton S'inscrire, l'icône de cœur et le nombre de likes dans une ligne -->
                            <div class="d-flex align-items-center">
                                <a href="{{ path('book_training', {'idFormation': training.id}) }}" class="btn btn-primary" style="margin-right: 10px;">S'inscrire</a>

                                <!-- Heart icon for likes -->
                                <i class="fas fa-heart" id="likeIcon{{ training.id }}" onclick="likeFormation({{ training.id }})"></i>

                                
                                <!-- Like count -->
                                <span id="likeCount{{ training.id }}" class="ml-2">{{ training.likes }}</span>

                                <!-- Icône de commentaire -->
                                
                            </div>
                    
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="col-md-12 d-flex justify-content-end mt-1">
        {% if L %}
            <a href="{{ path('add_formation') }}" id="add-training-link" class="btn btn-link">
                <i class="fas fa-plus-circle"></i> Add training
            </a>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var addProductButton = document.getElementById('add-training-link');
            if (addProductButton && "{{L}}" === "1") {
                addProductButton.style.display = 'block';
            }
             });

             function likeFormation(formationId) {
                                    // Make an AJAX request to the like_formation route
                                    fetch(`/like/${formationId}`, { method: 'POST' })
                                        .then(response => {
                                            // Handle the response, e.g., update the UI
                                            console.log('Formation liked successfully');

                                            // Toggle the 'liked' class to change the heart appearance
                                            const likeIcon = document.getElementById(`likeIcon${formationId}`);
                                            likeIcon.classList.toggle('liked');

                                            // Update the like count
                                            const likeCount = document.getElementById(`likeCount${formationId}`);
                                            const likeCountIcon = document.getElementById(`likeCountIcon${formationId}`);
                                            const currentCount = parseInt(likeCount.innerText);
                                            likeCount.innerText = likeIcon.classList.contains('liked') ? currentCount + 1 : currentCount - 1;

                                            // Update the like count icon (optional)
                                            likeCountIcon.style.color = likeIcon.classList.contains('liked') ? 'red' : '';
                                        })
                                        .catch(error => {
                                            console.error('Error liking formation:', error);
                                        });
                                }
       
    </script>

    <style>
        /* Add a style for the 'liked' class */
        .liked {
            color: #EE0F0F; /* Change the color to red */
            font-size: 26px; /* Increase the font size */
        }
    </style>
{% endblock %}
